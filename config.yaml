name: kuru-share-price-indexer
description: >
  Indexes share prices and TVL for Kuru delta-neutral QuoteOnlyVault clones.
  Tracks every Deposit, Withdraw, Rebalance and Rebalanced event to produce
  a time-series of { timestamp, sharePriceE18, tvl } per vault, plus a
  periodic block-level snapshot every ~100 blocks for continuity.

# Contract definitions with events (referenced by chains below)
contracts:
  # VaultFactory — two deployments (MONUSDC + MONAUSD markets).
  # Each VaultCreated event triggers dynamic registration of the clone.
  - name: VaultFactory
    abi_file_path: abis/VaultFactory.json
    handler: src/EventHandlers.ts
    events:
      - event: VaultCreated(address indexed user, address indexed vault)

  # QuoteOnlyVault — no fixed address; registered dynamically from
  # VaultCreated events via context.addNewContractRegistration().
  - name: QuoteOnlyVault
    abi_file_path: abis/QuoteOnlyVault.json
    handler: src/EventHandlers.ts
    events:
      - event: Deposit(address indexed user, uint256 quoteAmount, uint256 sharesMinted)
      - event: Withdraw(address indexed user, uint256 sharesBurned, uint256 quoteReturned, uint256 baseReturned)
      - event: Rebalance(bool indexed isDeleverage, uint256 ltvBefore, uint256 ltvAfter)
      - event: Rebalanced(address indexed caller, uint256 wmonRepaid, uint256 quotePayout)

# Chain configurations
chains:
  - id: 143  # Monad mainnet
    start_block: 55716667
    # RPC fallback (used when HyperSync does not cover a block range).
    # Set ENVIO_MONAD_RPC_URL in your environment or replace the placeholder below.
    rpc: ${ENVIO_MONAD_RPC_URL}
    
    contracts:
      - name: VaultFactory
        address:
          - "0xCcb57703b65A8643401b11Cb40878F8cE0d622A3"  # MONUSDC
          - "0x79B99A1e9fF8F16a198Dac4b42Fd164680487062"  # MONAUSD
      
      - name: QuoteOnlyVault
        # address intentionally omitted — populated at runtime via dynamic registration
